touchStart:function(e){e.preventDefault()},findParameters:function(e,t,n,r,i,s){var o=[],u=[-99,0,0,0,0],a=0,f=0,l=0,c=10,h=10,p=0,d=0,v=0,m=0,g=1,y=i*3/4,b=0,w=0,E=[],S=[0,0,0,0,0,0],x=0,T=0,N=0,C=-1,k=-1,L=0;while(l<t-1){if(l<t-4){if(e[l][0]-e[l+1][0]<0&&e[l+1][0]-e[l+2][0]<0&&e[l+2][0]-e[l+3][0]<0&&e[l+3][0]-e[l+4][0]<0){if(C!=0){T++}C=0}else if(e[l][0]-e[l+1][0]>0&&e[l+1][0]-e[l+2][0]>0&&e[l+2][0]-e[l+3][0]>0&&e[l+3][0]-e[l+4][0]>0){if(C!=1){T++}C=1}if(e[l][1]-e[l+1][1]<0&&e[l+1][1]-e[l+2][1]<0&&e[l+2][1]-e[l+3][1]<0&&e[l+3][1]-e[l+4][1]<0){if(k!=0){N++}k=0}else if(e[l][1]-e[l+1][1]>0&&e[l+1][1]-e[l+2][1]>0&&e[l+2][1]-e[l+3][1]>0&&e[l+3][1]-e[l+4][1]>0){if(k!=1){N++}k=1}}if(Math.abs(e[a][0]-e[l+1][0])<h){v=v+1}else if(p<v){p=v;v=0;a=l;E[0]=p+.5}else{a=l;v=0}if(p<v){p=v}if(Math.abs(e[f][1]-e[l+1][1])<c){m++}else if(d<m){d=m;E[1]=d+.6;f=l;m=0}else{f=l;m=0}if(d<m){d=m}if(e[l][0]<n+n/10){if(e[l][1]<r+r/10){u[1]++}else{u[3]++}}else if(e[l][1]<r){u[2]++}else{u[4]++}g=l+2;while(g<=t-2){var A=e[l][0],O=e[l][1],M=e[l+1][0],_=e[l+1][1],D=e[g][0],P=e[g][1],H=e[g+1][0],B=e[g+1][1],j=e[l][1]-e[l+1][1],F=e[l+1][0]-e[l][0],I=-1*F*e[l][1]+ -1*j*e[l][0],q=e[g][1]-e[g+1][1],R=e[g+1][0]-e[g][0],U=-1*R*e[g][1]+ -1*q*e[g][0],z=j*R-q*F;if(z!==0){var W=-1*(R*I-F*U)/z,X=-1*(j*U-q*I)/z}var V=Math.sqrt((e[l][0]-W)*(e[l][0]-W)+(e[l][1]-X)*(e[l][1]-X)),$=Math.sqrt((e[l+1][0]-W)*(e[l+1][0]-W)+(e[l+1][1]-X)*(e[l+1][1]-X)),J=Math.sqrt((e[g][0]-W)*(e[g][0]-W)+(e[g][1]-X)*(e[g][1]-X)),K=Math.sqrt((e[g+1][0]-W)*(e[g+1][0]-W)+(e[g+1][1]-X)*(e[g+1][1]-X));if(V+$<i+2&&V+$>i-2){if(J+K<i+2&&J+K>i-2){b++}}g++}l++}S[0]=u[1]+u[2];S[1]=u[3]+u[4];S[2]=u[1]+u[3];S[3]=u[4]+u[2];L=0;if(s.length>1){L=1}E[0]=S.indexOf(Math.max(S[0],S[1],S[2],S[3]));if(b>3){E[1]=4}else{E[1]=b}if(p>10)E[2]=1;else E[2]=0;if(d>10)E[3]=1;else E[3]=0;E[4]=L;if(T>5){E[5]=6}else{E[5]=T}if(N>5){E[6]=6}else{E[6]=N}Sandman.currentParameters="s"+E[0]+E[1]+E[2]+E[3]+E[4]+E[5]+E[6];return E},mouseMove:function(e,t,n,r){n[t]=[e.clientX,e.clientY];return n},touchMoving:function(e,t,n,r){n[t]=[e.touches[0].pageX,e.touches[0].pageY];return n},path_length:function(e,t,n){var r=1,i=0,s=0,o=0;while(r<e){if(r-1===n[o][1]){r++;if(o<n.length-1)o++}s=(t[r][0]-t[r-1][0])*(t[r][0]-t[r-1][0])+(t[r][1]-t[r-1][1])*(t[r][1]-t[r-1][1]);i=i+Math.sqrt(s);r=r+1}return i},fft:function(e,t,n){var r=[],s=[],o=[],u=[],a=[];if(t===1){return e}for(i=0;i<=t-2;i=i+2){r[i/2]=[e[i][0],e[i][1]];s[i/2]=[e[i+1][0],e[i+1][1]]}o=Sandman.fft(r,t/2,n);u=Sandman.fft(s,t/2,n);for(i=0;i<t/2;i++){a[i]=[o[i][0]+Math.cos(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][0]-n*Math.sin(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][1],o[i][1]+Math.cos(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][1]+n*Math.sin(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][0]];a[t/2+i]=[o[i][0]-Math.cos(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][0]+n*Math.sin(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][1],o[i][1]-Math.cos(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][1]-n*Math.sin(2*Math.PI*(i*Sandman.samplePoints/t)/Sandman.samplePoints)*u[i][0]]}return a},gestureReverser:function(e,t,n){var r=0,i=0,s=0,o=15,u=0,a=0,f=[],l=t.length,c=[];for(s=0;s<e.length;s++){e[s].push(0)}for(s=e[0][0];s<=e[0][1];s++){f[u]=t[s];u++}c[0]=[0,u-1];e[0][2]=1;r=0;while(1){if(u>=l){break}for(i=0;i<e.length;i++){if(e[i][2]===1){continue}if(Math.abs(f[c[r][0]][0]-t[e[i][0]][0])<o&&Math.abs(f[c[r][0]][1]-t[e[i][0]][1])<o){var h=0,p=0;for(s=c[c.length-1][0],h=c[c.length-1][1];s<h;s++,h--){p=f[s];f[s]=f[h];f[h]=p}for(s=e[i][0];s<=e[i][1];s++){f[u++]=t[s]}e[i][2]=1;c[c.length-1][1]=u-1;a=1}else if(Math.abs(f[c[r][1]][0]-t[e[i][1]][0])<o&&Math.abs(f[c[r][1]][1]-t[e[i][1]][1])<o){for(s=e[i][1];s>=e[i][0];s--){f[u++]=t[s]}e[i][2]=1;c[c.length-1][1]=u-1;a=1}else if(Math.abs(f[c[r][1]][0]-t[e[i][0]][0])<o&&Math.abs(f[c[r][1]][1]-t[e[i][0]][1])<o){for(s=e[i][0];s<=e[i][1];s++){f[u++]=t[s]}e[i][2]=1;c[c.length-1][1]=u-1;a=1}else if(Math.abs(f[c[r][0]][0]-t[e[i][1]][0])<o&&Math.abs(f[c[r][0]][1]-t[e[i][1]][1])<o){var h=0,p=0;for(s=c[c.length-1][0],h=c[c.length-1][1];s<h;s++,h--){p=f[s];f[s]=f[h];f[h]=p}for(s=e[i][1];s>=e[i][0];s--){f[u++]=t[s]}e[i][2]=1;c[c.length-1][1]=u-1;a=1}}if(a===0){r++;c[c.length]=[c[c.length-1][1]+1,0];s=0;while(1){if(s>=e.length){break}if(e[s][2]===0){break}s++}if(s===e.length){break}else{var d=0;for(d=e[s][0];d<=e[s][1];d++){f[u++]=t[d]}e[s][2]=1;c[c.length-1][1]=u-1}}else{a=0}}Sandman.keyPoints=c;return f},compare:function(e,t,n,r,i,s){var o=1,u=1,a=0,f=0,l=15,c=0,h=0,p=Math.abs(n-r);if(n>r){o=-1}if(i>s){u=-1}f=i;for(a=0;a<Math.abs(r-n)&&f<Math.abs(s-i);a=a+o){if(Math.abs(e[a+n][0]-t[f][0])<l&&Math.abs(e[a+n][1]-t[f][1])<l){c++}f=f+u}return c},gestureCompare:function(e,t,n){var r=0,i=0,s=0,o=0,u=0,a=0,f=e,l=0,c=0,h=0,p=15,d=16,v=0,m=n;Sandman.keyPoints=n;Sandman.currentGesture=f;for(u=0;u<7;u++){t[5]=(t[5]+1)%7;for(a=0;a<7;a++){t[6]=(t[6]+1)%7;for(i=0;i<5;i++){t[1]=(t[1]+1)%5;for(s=0;s<2;s++){t[3]=(t[3]+1)%2;for(o=0;o<2;o++){t[2]=(t[2]+1)%2;for(l=0;l<4;l++){h=0;c++;t[0]=(t[0]+1)%4;Sandman.set="s"+t[0]+t[1]+t[2]+t[3]+t[4]+t[5]+t[6];if(typeof window.Sandman[Sandman.set]!="undefined"){var g=window.Sandman[Sandman.set].length,y=0;var b=0,w=-1;for(y=0;y<g;y++){h=0;var E=0,S=0,x=0,T=-1,N=Sandman.gestureArray[window.Sandman[Sandman.set][y]];if(N[33].length!=m.length){continue}var C=N[33].length,k=N[33];while(x<m.length){if(Math.abs(f[m[x][0]+1][0]-f[m[x][1]][0])<p&&Math.abs(f[m[x][0]+1][1]-f[m[x][1]][1])<p){var L=m[x][0]+1,l=0;for(l=m[x][0]+2;l<=m[x][1];l++){if(f[l][0]<f[L][0]){L=l}else if(f[l][0]===f[L][0]){if(f[l][1]<f[L][1]){L=l}}}for(gest1Ptr=0;gest1Ptr<k.length;gest1Ptr++){if(Math.abs(N[k[gest1Ptr][0]+2][0]-N[k[gest1Ptr][1]][0])<p&&Math.abs(N[k[gest1Ptr][0]+2][1]-N[k[gest1Ptr][1]][1])<p){var A=k[gest1Ptr][0]+2;for(l=k[gest1Ptr][0]+3;l<=k[gest1Ptr][1];l++){if(N[l][0]<N[A][0]){A=l}else if(N[l][0]===N[A][0]){if(N[l][1]<N[A][1]){A=l}}}if(Math.abs(N[A][0]-f[L][0])>p||Math.abs(N[A][1]-f[L][1]>p)){break}if(N[A][1]>N[A+2][1]&&f[L][1]>f[L+2][1]||N[A][1]<N[A+2][1]&&f[L][1]<f[L+2][1]){var O=0,M=0,_=0,D=m[x][0],P=m[x][1],H=k[gest1Ptr][0],B=k[gest1Ptr][1],j=Math.abs(H-B),F=0;for(O=A-H,M=L-D;F<j;O++,M++){if(Math.abs(N[H+O%j][0]-f[D+M%j][0])<p&&Math.abs(N[H+O%j][1]-f[D+M%j][1])<p){h++}F++}S=1}else{var I=1,q=1,O=0,M=0,F=0,_=0,D=m[x][0],P=m[x][1],H=k[gest1Ptr][0],B=k[gest1Ptr][1],j=Math.abs(H-B);if(H>B){for(O=B-A,M=L-D;F<j;O++,M++){if(Math.abs(N[B-O%j][0]-f[D+M%j][0])<p&&Math.abs(N[B-O%j][1]-f[D+M%j][1])<p){h++}F++}}else{for(O=A-H,M=P-L;F<j;O++,M++){if(Math.abs(N[H+O%j][0]-f[P-M%j][0])<p&&Math.abs(N[H+O%j][1]-f[P-M%j][1])<p){h++}F++}}var F=0;S=1}}}}else{S=1;for(gest1Ptr=0;gest1Ptr<k.length;gest1Ptr++){if(Math.abs(N[k[gest1Ptr][0]+2][0]-f[m[x][0]+1][0])<=p+5&&Math.abs(N[k[gest1Ptr][0]+2][1]-f[m[x][0]+1][1])<=p+5||Math.abs(N[k[gest1Ptr][1]][0]-f[m[x][1]][0])<=p+5&&Math.abs(N[k[gest1Ptr][1]][1]-f[m[x][1]][1])<=p+5){h=h+Sandman.compare(N,f,k[gest1Ptr][0],k[gest1Ptr][1],m[x][0],m[x][1])}else if(Math.abs(N[k[gest1Ptr][0]+2][0]-f[m[x][1]][0])<=p+5&&Math.abs(N[k[gest1Ptr][0]+2][1]-f[m[x][1]][1])<=p+5||Math.abs(N[k[gest1Ptr][1]][0]-f[m[x][0]+1][0])<=p+5&&Math.abs(N[k[gest1Ptr][1]][1]-f[m[x][0]+1][1])<=p+5){h=h+Sandman.compare(N,f,k[gest1Ptr][1],k[gest1Ptr][0],m[x][0],m[x][1])}}}if(S!=1){T=1;break}x++}if(S===1){if(w<h){maxMatchedIndex=window.Sandman[Sandman.set][y];w=h}}}}if(w>=d){if(typeof window[Sandman.gestureArray[maxMatchedIndex][0]]!="undefined"){window[Sandman.gestureArray[maxMatchedIndex][0]]();return}else{window["defaultFunc"]()}return}}}}}}}},sample:function(e,t,n,r){t=Sandman.gestureReverser(r,t,r.length);r=Sandman.keyPoints;if(e<=0){return}var i=5,s=0,o=5;while(s<Sandman.keyPoints.length){for(o=5;o<Sandman.keyPoints[0][1]-5;o++){t[o][0]=Math.floor((t[o-5][0]+t[o-4][0]+t[o-3][0]+t[o-2][0]+t[o-1][0]+t[o][0]+t[o+1][0]+t[o+2][0]+t[o+3][0]+t[o+4][0]+t[o+5][0])/11);t[o][1]=Math.floor((t[o-5][1]+t[o-4][1]+t[o-3][1]+t[o-2][1]+t[o-1][1]+t[o][1]+t[o+1][1]+t[o+2][1]+t[o+3][1]+t[o+4][1]+t[o+5][1])/11)}t[e-5][0]=Math.floor((t[e-10][0]+t[e-9][0]+t[e-8][0]+t[e-7][0]+t[e-6][0]+t[e-5][0]+t[e-4][0]+t[e-3][0]+t[e-2][0]+t[e-1][0])/10);t[e-5][1]=Math.floor((t[e-10][1]+t[e-9][1]+t[e-8][1]+t[e-7][1]+t[e-6][1]+t[e-5][1]+t[e-4][1]+t[e-3][1]+t[e-2][1]+t[e-1][1])/10);t[e-4][0]=Math.floor((t[e-9][0]+t[e-8][0]+t[e-7][0]+t[e-6][0]+t[e-5][0]+t[e-4][0]+t[e-3][0]+t[e-2][0]+t[e-1][0])/9);t[e-4][1]=Math.floor((t[e-9][1]+t[e-8][1]+t[e-7][1]+t[e-6][1]+t[e-5][1]+t[e-4][1]+t[e-3][1]+t[e-2][1]+t[e-1][1])/9);t[e-3][0]=Math.floor((t[e-8][0]+t[e-7][0]+t[e-6][0]+t[e-5][0]+t[e-4][0]+t[e-3][0]+t[e-2][0]+t[e-1][0])/8);t[e-3][1]=Math.floor((t[e-8][1]+t[e-7][1]+t[e-6][1]+t[e-5][1]+t[e-4][1]+t[e-3][1]+t[e-2][1]+t[e-1][1])/8);t[e-2][0]=Math.floor((t[e-7][0]+t[e-6][0]+t[e-5][0]+t[e-4][0]+t[e-3][0]+t[e-2][0]+t[e-1][0])/7);t[e-2][1]=Math.floor((t[e-7][1]+t[e-6][1]+t[e-5][1]+t[e-4][1]+t[e-3][1]+t[e-2][1]+t[e-1][1])/7);t[e-1][0]=Math.floor((t[e-6][0]+t[e-5][0]+t[e-4][0]+t[e-3][0]+t[e-2][0]+t[e-1][0])/6);t[e-1][1]=Math.floor((t[e-6][1]+t[e-5][1]+t[e-4][1]+t[e-3][1]+t[e-2][1]+t[e-1][1])/6);s++}var u=1,a=Sandman.path_length(e,t,r),f=[],l=[],c=0,h=a/(Sandman.samplePoints-1),p=0,d=0,v=0;n=[-9999,-9999,9999,9999];for(u=0;u<e;u++){if(t[u][0]<n[2])n[2]=t[u][0];if(t[u][0]>n[0])n[0]=t[u][0];if(t[u][1]<n[3])n[3]=t[u][1];if(t[u][1]>n[1])n[1]=t[u][1]}var m=Math.sqrt((n[0]-n[2])*(n[0]-n[2])+(n[1]-n[3])*(n[1]-n[3]))/100;f[0]=t[0][0];l[0]=t[0][1];c=1;var g=0,y=[],b=0,w=0,E=0;y=[[0,-99]];u=1;while(u<e){d=(t[u][0]-t[u-1][0])*(t[u][0]-t[u-1][0])+(t[u][1]-t[u-1][1])*(t[u][1]-t[u-1][1]);v=Math.sqrt(d);if(u===Sandman.keyPoints[g][1]){u++;if(g<Sandman.keyPoints.length-1){g++}y[y.length-1][1]=c-1;if(u>=e-1){break}y[y.length]=[c,0]}if(p+v>=h){f[c]=t[u-1][0]+(h-p)/v*(t[u][0]-t[u-1][0]);l[c]=t[u-1][1]+(h-p)/v*(t[u][1]-t[u-1][1]);t[u-1][0]=f[c];t[u-1][1]=l[c];p=0;c=c+1;u=u-1}else{p=p+v}u=u+1}if(c<=31){f[c]=t[e-1][0];l[c]=t[e-1][1];c++}y[y.length-1][1]=c-1;r=[];r=y;var S=[];for(u=0;u<c;u++){S[u]=[];S[u][0]=Math.round(f[u]);S[u][1]=Math.round(l[u])}var x=Sandman.findParameters(S,Sandman.samplePoints,(n[0]+n[2])/2,(n[1]+n[3])/2,h,y);var T=Sandman.fft(S,Sandman.samplePoints,1);var N=T;var C=T;for(u=1;u<Sandman.samplePoints;u++){C[u][0]=C[u][0]/m;C[u][1]=C[u][1]/m}C[0][0]=500;C[0][1]=500;var C=Sandman.fft(C,Sandman.samplePoints,-1);for(u=1;u<Sandman.samplePoints;u++){C[u][0]=Math.round(C[u][0]/Sandman.samplePoints);C[u][1]=Math.round(C[u][1]/Sandman.samplePoints)}var k=0;var L=0;N=C;var A=0;Sandman.set="s"+x[0]+x[1]+x[2]+x[3]+x[4];Sandman.gesture[Sandman.gestPtr]=N;Sandman.gestPtr++;Sandman.gestureCompare(C,x,y);chainInputPtr=0;c=0;e=0;n=[-9999,-9999,9999,9999];n[0]=-9999;n[1]=-9999;n[2]=9999;n[3]=9999},doFirst:function(e){var t=0,n=[],r=0,i=0,s=1,o=0,u=null,a=[];a=[-9999,-9999,9999,9999];document.getElementById(e).addEventListener("touchstart",function(e){e.preventDefault();s=0;a=[-9999,-9999,9999,9999];Sandman.touchStart(e)},false);document.getElementById(e).addEventListener("touchmove",function(l){if(t===0){t=1;f=document.getElementById(e).addEventListener("touchend",function(e){i=0;s=1;if(Sandman.keyPoints.length===0){Sandman.keyPoints[0]=[0,r-1]}else{Sandman.keyPoints[Sandman.keyPoints.length]=[Sandman.keyPoints[Sandman.keyPoints.length-1][1]+1,r-1]}if(o===0){o=1;u=setInterval(function(){if(s===1){clearInterval(u);Sandman.sample(r,n,a,Sandman.keyPoints);o=0;r=0}},2e3)}},false)}n=Sandman.touchMoving(l,r,n,a);r++},false);document.getElementById(e).addEventListener("mousedown",function(e){s=0;a=[-9999,-9999,9999,9999];i=1;Sandman.touchStart(e)},false);var f=null;document.getElementById(e).addEventListener("mousemove",function(l){if(t===0){t=1;f=document.getElementById(e).addEventListener("mouseup",function(e){i=0;s=1;if(Sandman.keyPoints.length===0){Sandman.keyPoints[0]=[0,r-1]}else{Sandman.keyPoints[Sandman.keyPoints.length]=[Sandman.keyPoints[Sandman.keyPoints.length-1][1]+1,r-1]}if(o===0){o=1;u=setInterval(function(){if(s===1){clearInterval(u);Sandman.sample(r,n,a,Sandman.keyPoints);o=0;r=0}},500)}},false)}if(i===1){n=Sandman.mouseMove(l,r,n,a);r++}},false);Sandman.gesture=[];Sandman.gestPtr=0;x=document.getElementById(e)}}
